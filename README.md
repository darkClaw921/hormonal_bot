# Hormonal Bot

Telegram бот для отслеживания менструального цикла с уведомлениями для пользователя и партнеров.

## Описание

Hormonal Bot — это Telegram бот, который помогает пользователям отслеживать свой менструальный цикл, получать информацию о текущей фазе цикла, рекомендации по самочувствию, физической активности и питанию. Бот также позволяет делиться информацией о цикле с партнерами через систему приглашений.

## Основные возможности

- **Отслеживание цикла**: Ввод дня цикла с автоматическим определением фазы
- **Расчет фаз**: Автоматическое определение текущей фазы цикла (менструальная, постменструальная, овуляторная, постовуляторная, ПМС)
- **Рекомендации**: Персонализированные советы по самочувствию, активности и питанию для каждой фазы
- **Статистика**: Просмотр истории циклов, средней длины цикла и другой статистики
- **Партнеры**: Возможность делиться информацией о цикле с партнерами через систему приглашений
- **Уведомления**: Автоматические уведомления о переходе в новую фазу цикла и еженедельные напоминания
- **Настройки**: Настройка длины цикла, времени уведомлений и их включение/выключение

## Технологии

- **Python 3.12+**: Язык программирования
- **aiogram 3.23+**: Асинхронный фреймворк для создания Telegram ботов
- **SQLAlchemy 2.0+**: ORM для работы с базой данных
- **APScheduler 3.10+**: Планировщик задач для отправки уведомлений
- **Alembic 1.13+**: Миграции базы данных
- **aiosqlite 0.19+**: Асинхронный драйвер для SQLite
- **pytest 8.0+**: Фреймворк для тестирования

## Установка и настройка

### Требования

- Python 3.12 или выше
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))

### Установка зависимостей

Проект использует `uv` для управления зависимостями:

```bash
# Установка зависимостей
uv sync
```

### Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```env
BOT_TOKEN=your_telegram_bot_token
DATABASE_URL=sqlite+aiosqlite:///hormonal_bot.db
LOG_LEVEL=INFO
DEBUG=false
```

### Инициализация базы данных

```bash
# Применение миграций
alembic upgrade head
```

## Запуск

```bash
# Запуск бота
uv run hormonal_bot_main.py
```

## Структура проекта

Проект организован по модульному принципу:

- `bot/` - Конфигурация и инициализация бота
- `handlers/` - Обработчики сообщений и команд
- `services/` - Бизнес-логика (расчет фаз, статистика, партнеры, уведомления)
- `database/` - Модели данных и миграции
- `keyboards/` - Inline и Reply клавиатуры
- `middlewares/` - Middleware для обработки запросов
- `tasks/` - Периодические задачи (уведомления)
- `tests/` - Unit и интеграционные тесты

Подробное описание архитектуры проекта см. в [architecture.md](architecture.md).

## Тестирование

Проект включает unit и интеграционные тесты:

```bash
# Запуск всех тестов из корня
uv run pytest

# Запуск с подробным выводом
uv run pytest -v

# Запуск конкретного теста
uv run pytest tests/unit/test_cycle_service.py
```

## Управление задачами (bd)

Проект использует систему **bd** (beads) для отслеживания задач и этапов разработки.

### Основные команды

```bash
# Показать готовые к работе задачи
bd ready

# Показать детали задачи
bd show <id>

# Взять задачу в работу
bd update <id> --status in_progress

# Закрыть задачу
bd close <id>

# Синхронизировать с git
bd sync
```

Подробнее о работе с задачами см. в [AGENTS.md](AGENTS.md).

## Лицензия

Проект находится в разработке.
